# 수수료

- [코빗 거래수수료](https://support.korbit.co.kr/customer/ko/portal/articles/2745022-거래-수수료-maker-taker-fee-는-어떻게-되나요-)
  ![img](https://support.korbit.co.kr/customer/portal/attachments/943949)

- [거래수수료 구분]([https://support.korbit.co.kr/customer/ko/portal/articles/2948345-%EA%B1%B0%EB%9E%98-%EC%88%98%EC%88%98%EB%A3%8C-%EA%B5%AC%EB%B6%84%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%98%EB%82%98%EC%9A%94-](https://support.korbit.co.kr/customer/ko/portal/articles/2948345-거래-수수료-구분은-어떻게-되나요-))
  - Taker 주문 : 즉시 체결되는 주문
       - 시장가로 주문
       - 지정가 주문 시, 이미 오더북에 올라와있는 주문과 동일한 금액으로 주문
       - 지정가 매수 주문 시, 체결 가능한 호가보다 높은 가격으로 주문
            - `최대 매수호가`  <  `매수주문가` → 비싸게 사겠다고 하니까 즉시 체결
       - 지정가 매도 주문 시, 체결 가능한 호가보다 낮은 가격으로 주문
            - `최소 매도호가` > `매도주문가`  → 싸게 팔겠다고 하니까 즉시 체결
  - **Maker 주문** : 즉시 체결되지 않는 주문
    - 지정가 매수 주문 시, 체결 가능한 호가보다 낮은 가격으로 주문
      - `최대 매수호가`  >  `매수주문가` → 싸게 사겠다고 하는 무리 중 하나
    - 지정가 매도 주문 시, 체결 가능한 호가보다 높은 가격으로 주문
      - `최소 매도호가` < `매도주문가`  → 비싸게 팔겠다고 하는 무리 중 하나

# 용어

- `최근내주문체결가`: 나의 주문 중 마지막으로 체결된 거래의 거래가
- `목표 밸런싱비율`:  "코인 평가금액 : 예수금잔고"의 목표 비율 
- `현재 밸런싱비율`:  "코인 평가금액 : 예수금잔고"의 현재 비율 
- `거래트리거링가격변동포인트`: 이 %포인트 만큼 체결가 변동이 일어나면 리밸런싱한다

# 주문가/주문량 산출

#### Args

  - 목표 밸런싱비율
  - 최근내주문체결가
  - 보유량
  - 예수금잔고
  - env:
    - 제약조건
      - tick_size 호가단위
      - min_price 최소 주문가
      - order_min_size 최소 주문량
      - max_price 최대 주문가
      - order_max_size 최대 주문량
    - 체결가

#### Return

- 매도주문:
  - 주문가
  - 주문량
  - 호가 증가%
- 매수주문:
  - 주문가
  - 주문량
  - 호가 감소%

#### 주문량 계산
`목표밸런싱비율`은 입력값으로 고정이다
$$
목표밸런싱비율 = {{희망평가금액 + 주문금액} \over {예수금잔고 - 주문금액}}
$$
여기서
$$
주문금액 = 주문량 \cdot 주문가
$$
$$
희망평가금액 = 보유량 \cdot 주문가
$$

따라서
$$
주문량 = 
{
  {{목표 밸런싱비율 \cdot 예수금잔고 \over 주문가} - 보유량} 
  \over 
  {1 + 목표 밸런싱비율}
}
$$
여기서
$$
주문가 = 최근내주문체결가 (1 \pm 거래트리거링가격변동포인트)
$$

만약
$$
주문량 < 최소 주문량
$$
이라면
$$
주문량 = 최소주문량
$$

$$
주문가 =
{
  {목표밸런싱비율 \cdot 예수금잔고} \over
  최소주문량 ( 1 + 목표밸런싱비율) + 보유량
}  
$$



